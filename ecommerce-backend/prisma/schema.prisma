generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int               @id @default(autoincrement())
  email            String            @unique
  firstName        String?
  lastName         String?
  displayName      String?
  photoUrl         String?
  phoneNumber      String?
  gender           String?
  password         String
  resetToken       String?
  resetTokenExpiry DateTime?
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  stripeCustomerId String?           @unique
  needHelpRequests NeedHelpRequest[]
  orders           Order[]
  refreshTokens    RefreshToken[]
  wishlists        Wishlist[]
  addresses        Address[]
  carts            Cart[]
  paymentCards     PaymentCard[]
  payments         Payment[]
}

model NeedHelpRequest {
  id          Int      @id @default(autoincrement())
  userId      Int
  description String
  type        String
  status      String   @default("sent")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id])
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  userId    Int
  expiresAt DateTime
  createdAt DateTime @default(now())
  revoked   Boolean  @default(false)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Wishlist {
  id             Int            @id @default(autoincrement())
  user_id        Int
  name           String
  is_default     Boolean        @default(false)
  created_at     DateTime       @default(now())
  updated_at     DateTime       @updatedAt
  user           User           @relation(fields: [user_id], references: [id])
  wishlist_items WishlistItem[]
}

model WishlistItem {
  id          Int      @id @default(autoincrement())
  wishlist_id Int
  product_id  Int?
  added_at    DateTime @default(now())
  productId   Int?
  product     Product? @relation(fields: [productId], references: [id])
  wishlist    Wishlist @relation(fields: [wishlist_id], references: [id], onDelete: Cascade)

  @@unique([wishlist_id, product_id])
}

model Category {
  id                Int        @id @default(autoincrement())
  parentCategoryId  Int?       @map("parent_category_id")
  name              String
  categoryUniqueKey String
  description       String?
  image             String?
  svg               String?
  displayOrder      Int?       @default(0) @map("display_order")
  isFeatured        Boolean    @default(false) @map("is_featured")
  isActive          Boolean    @default(true) @map("is_active")
  createdAt         DateTime   @default(now()) @map("created_at")
  updatedAt         DateTime   @updatedAt @map("updated_at")
  products          Product[]
  parentCategory    Category?  @relation("CategoryHierarchy", fields: [parentCategoryId], references: [id])
  children          Category[] @relation("CategoryHierarchy")

  @@map("categories")
}

model Product {
  id                       Int                     @id @default(autoincrement())
  name                     String
  description              String?
  categoryId               Int?                    @map("category_id")
  subcategoryId            Int?                    @map("subcategory_id")
  subcategoryProductTypeId Int?                    @map("subcategory_product_type_id")
  createdAt                DateTime                @default(now()) @map("created_at")
  updatedAt                DateTime                @updatedAt @map("updated_at")
  orderItems               OrderItem[]
  category                 Category?               @relation(fields: [categoryId], references: [id])
  subcategory              Subcategory?            @relation("ProductToSubcategory", fields: [subcategoryId], references: [id])
  subcategoryProductType   SubcategoryProductType? @relation("ProductToSubcategoryProductType", fields: [subcategoryProductTypeId], references: [id])
  productVariants          ProductVariant[]
  wishlistItems            WishlistItem[]
  carts                    Cart[]
}

model ProductVariant {
  sku             String   @id @unique
  name            String
  description     String
  price           Decimal  @db.Decimal(10, 2)
  discountedPrice Decimal? @db.Decimal(10, 2)
  stock           Int
  color           String
  size            String
  rating          Decimal? @db.Decimal(3, 2)
  reviewCount     Int
  boughtCount     Int
  images          String[]
  isActive        Boolean  @default(true)
  productId       Int
  product         Product  @relation(fields: [productId], references: [id])
  cartItems       Cart[]
}

model Subcategory {
  id           Int                      @id @default(autoincrement())
  name         String
  description  String?
  image        String?
  displayOrder Int?                     @map("display_order")
  isActive     Boolean                  @default(true) @map("is_active")
  categoryId   Int                      @map("category_id")
  createdAt    DateTime                 @default(now()) @map("created_at")
  updatedAt    DateTime                 @updatedAt @map("updated_at")
  products     Product[]                @relation("ProductToSubcategory")
  productTypes SubcategoryProductType[]
}

model SubcategoryProductType {
  id            Int         @id @default(autoincrement())
  name          String
  slug          String      @unique
  description   String?
  image         String?
  filters       Json?
  displayOrder  Int?        @map("display_order")
  isActive      Boolean     @default(true) @map("is_active")
  subcategoryId Int         @map("subcategory_id")
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  products      Product[]   @relation("ProductToSubcategoryProductType")
  subcategory   Subcategory @relation(fields: [subcategoryId], references: [id], onDelete: Cascade)
}

model Order {
  id              Int           @id @default(autoincrement())
  userId          Int
  totalAmount     Decimal       @db.Decimal(10, 2)
  shippingAddress Json          @map("shipping_address")
  promocode       String?       @map("promo_code")
  status          OrderStatus   @default(PENDING)
  paymentMethod   String        @map("payment_method")
  paymentStatus   PaymentStatus @default(PENDING) @map("payment_status")
  rating          OrderRating?  @map("rating")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  user            User          @relation(fields: [userId], references: [id])
  orderItems      OrderItem[]
  payments        Payment[]
}

model OrderItem {
  id              Int      @id @default(autoincrement())
  orderId         Int      @map("order_id")
  productId       Int?     @map("product_id")
  productSnapshot Json     @map("product_snapshot")
  quantity        Int      @default(1)
  price           Decimal  @db.Decimal(10, 2)
  subtotal        Decimal  @db.Decimal(10, 2)
  variantInfo     String?  @map("variant_info")
  createdAt       DateTime @default(now()) @map("created_at")
  order           Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product         Product? @relation(fields: [productId], references: [id])
}

model Cart {
  id                Int             @id @default(autoincrement())
  userId            Int             @map("user_id")
  productId         Int             @map("product_id")
  productVariantSku String?         @map("product_variant_sku")
  quantity          Int             @default(1)
  price             Decimal         @db.Decimal(10, 2)
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")
  product           Product         @relation(fields: [productId], references: [id])
  productVariant    ProductVariant? @relation(fields: [productVariantSku], references: [sku])
  user              User            @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([productId])
  @@map("carts")
}

model PaymentCard {
  id                    Int       @id @default(autoincrement())
  userId                Int
  stripePaymentMethodId String    @unique
  brand                 String
  last4                 String
  expMonth              Int
  expYear               Int
  cardholderName        String
  country               String?
  fingerprint           String?
  isDefault             Boolean   @default(false)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments              Payment[]

  @@index([userId, isDefault])
  @@map("payment_cards")
}

model Payment {
  id                    Int          @id @default(autoincrement())
  userId                Int
  orderId               Int
  paymentCardId         Int?
  stripePaymentIntentId String       @unique
  stripePaymentMethodId String
  amount                Decimal      @db.Decimal(10, 2)
  currency              String       @default("INR")
  status                String
  receiptUrl            String?
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
  order                 Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)
  paymentCard           PaymentCard? @relation(fields: [paymentCardId], references: [id])
  user                  User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([orderId])
  @@index([paymentCardId])
  @@map("payments")
}

model Address {
  id           Int      @id @default(autoincrement())
  userId       Int
  line1        String
  line2        String?
  city         String
  state        String
  zipCode      String
  country      String
  buildingName String?
  addressType  String
  isDefault    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("addresses")
}

model DashboardOffer {
  id            Int      @id @default(autoincrement())
  title         String
  subtitle      String?
  description   String?
  discountLabel String?  @map("discount_label")
  actionLabel   String?  @map("action_label")
  targetUrl     String?  @map("target_url")
  imageUrl      String?  @map("image_url")
  isActive      Boolean  @default(true) @map("is_active")
  displayOrder  Int?     @map("display_order")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("dashboard_offers")
}

model DashboardBrand {
  id           Int      @id @default(autoincrement())
  name         String
  tagline      String?
  logoUrl      String?  @map("logo_url")
  isFeatured   Boolean  @default(false) @map("is_featured")
  displayOrder Int?     @map("display_order")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("dashboard_brands")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum OrderRating {
  VERY_BAD
  BAD
  GOOD
  VERY_GOOD
}
